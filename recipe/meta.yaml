{% set name = "soem" %}
{% set version = "2.0.0" %}

package:
  name: {{ name }}
  version: {{ version }}

source:
  - url: https://github.com/OpenEtherCATsociety/{{ name }}/archive/v{{ version }}.tar.gz
    sha256: 1f1f38464c5542d8cd1b1d8f27d9af6422d03b9364a9f31ad66f1919f2898f16

build:
  number: 0
  # Windows support is currently disabled as:
  # * no shared build is supported by default on Windows (static attributes are used to we can't simply use CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS)
  # * the build by default uses a vendored hardcoded library for winpcap (https://github.com/OpenEtherCATsociety/SOEM/tree/master/oshw/win32/wpcap/Lib)
  # * even if we devendored winpcap, the library is deprecated (see https://github.com/microsoft/vcpkg/pull/33215 and https://www.winpcap.org/)
  # If anyone is interested in working on this, please check https://github.com/conda-forge/soem-feedstock/issues/3
  skip: true  # [osx and win]
  run_exports:
    - {{ pin_subpackage(name, max_pin='x.x') }}

requirements:
  build:
    - {{ compiler('cxx') }}
    - {{ compiler('c') }}
    - {{ stdlib("c") }}
    - ninja
    - cmake

test:
  commands:
    - test -f ${PREFIX}/include/soem/ethercat.h  # [not win]
    - test -f ${PREFIX}/bin/slaveinfo  # [not win]
    - test -f ${PREFIX}/lib/libsoem.so  # [not win]
    - if exist %PREFIX%\\Library\\include\\soem\\ethercat.h (exit 0) else (exit 1)  # [win]
    - if exist $PREFIX$\\Library\\lib\\soem.lib (exit 0) else (exit 1)  # [win]
    - if exist $PREFIX$\\Library\\bin\\soem.dll (exit 0) else (exit 1)  # [win]
    - if exist $PREFIX$\\Library\\bin\\slaveinfo.exe (exit 0) else (exit 1)  # [win]

about:
  home: https://openethercatsociety.github.io/
  license: GPL-3.0-only
  license_file: LICENSE
  summary: |
    Simple Open Source EtherCAT Master

extra:
  recipe-maintainers:
    - seanyen
    - traversaro
